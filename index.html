<style>body,html{background:#000}canvas{right:50%;bottom:50%;transform:translate(50%,50%);position:absolute;width:100%}</style><canvas id="canvas"width="981"height="506"></canvas><script>'use strict';var Ca;
(function(p){function g(a=0,b=0){return new Y(a,b)}function ca(a){return new Y(a.x,a.y)}function u(a,b){return g(a.x+b.x,a.y+b.y)}function l(a,b){return g(a.x-b.x,a.y-b.y)}function Da(a,b){return g(a.x*b.x,a.y*b.y)}function Ea(a,b){return a.x*b.x+a.y*b.y}function m(a,b){return g(a.x*b,a.y*b)}function Fa(a,b){return a.x*b.y-a.y*b.x}function ka(a){return g(Math.sign(a.x),Math.sign(a.y))}function y(a){return a.x*a.x+a.y*a.y}function A(a){return m(a,1/Math.sqrt(y(a)))}function da(a,b,c=b){let d=Math.sqrt(y(a));
return 0===d?a:d<b?m(A(a),b):d>c?m(A(a),c):a}function Ga(a,b){let c=Math.cos(b);b=Math.sin(b);return g(c*a.x-b*a.y,b*a.x+c*a.y)}function B(a,b,c){return Math.max(Math.min(a,c),b)}function ab(a,b,c=.01){return Math.abs(a-b)<c}function x(a=0,b=1){return a+(b-a)*Math.random()}function Ha(...a){return a[x(0,a.length)|0]}function bb(a,b){let c=g(Math.min(a.x,b.x),Math.min(a.y,b.y));a=g(Math.max(a.x,b.x),Math.max(a.y,b.y));return[m(u(c,a),.5),m(l(a,c),.5)]}function la(a,[b,c]){a=l(a,b);return Math.abs(a.x)<
c.x&&Math.abs(a.y)<c.y}function ma([a,b],[c,d]){return la(a,[c,u(b,d)])}function na(a,b,c){var d=(a)=>{let [b,d]=c;return g(b.x+[-d.x,d.x,d.x,-d.x][a%4],b.y+[-d.y,-d.y,d.y,d.y][a%4])},e=l(b,a);let f=Array(4);for(var h=0;4>h;++h){let c=d(h),g=d(h+1);var k=l(g,c);if(0>=Fa(k,l(a,c))&&0<=Fa(k,l(b,c))){if(0==e.x){(0==h||2==h)&&a.x>Math.min(c.x,g.x)&&a.x<Math.max(c.x,g.x)&&(f[h]=new Y(a.x,c.y));continue}k=e.y/e.x;const b=a.y-k*a.x;if(0==h||2==h){if(0!=k){var L=c.y;k=(L-b)/k;k>Math.min(c.x,g.x)&&k<Math.max(c.x,
g.x)&&(f[h]=new Y(k,L))}}else L=c.x,k=k*L+b,k>Math.min(c.y,g.y)&&k<Math.max(c.y,g.y)&&(f[h]=new Y(L,k))}}b=Number.MAX_VALUE;d=-1;for(e=0;4>e;++e)f[e]&&(h=y(l(f[e],a)),h<b&&(b=h,d=e));if(-1!=d)return[f[d],[R,M,oa,N][d]]}function Ia(a=1,b=0,c=0,d=1,e=0,f=0){return new Float32Array([a,b,0,c,d,0,e,f,1])}function pa(a,b){return g(a.x*b[0]+a.y*b[3]+b[6],a.x*b[1]+a.y*b[4]+b[7])}function cb(a,b){if(0!=a.length){var c=0;for(let d=1;d<a.length;++d)b(a[c],a[d])&&(c=d);return a[c]}}function q(a,b,c=""){b.a=a;
b.name=c;a.Ba.push(b);return b}function n(a,b,{x:c=0,y:d=0,width:e=10,height:f=10,root:h=!1,Aa:k=0,name:g=""}){b.f.x=c;b.f.y=d;b.h.x=e;b.h.y=f;b.Oa=k;h&&(a.root=b);return q(a,b,g)}function db(a,b,c,d=g()){let e=0,f=0;for(let h of c.toUpperCase())"\n"===h?(f+=a.Xa,e=0):(b.drawImage(a.uc,a.Qb[h],0,a.Ya,a.Xa,e+d.x,f+d.y,a.Ya,a.Xa),e+=a.Ya-1)}function Ja(a,b,c){let d=document.createElement("canvas");d.width=a;d.height=b;a=d.getContext("2d");a.cd=!1;c&&c(a,d);return d}function Ka(a){return a instanceof
HTMLImageElement?a&&a.complete&&0!==a.naturalHeight:!0}function La(a,b=300,c=50,d=1,e=8){var f=a.c;let h=a.o();for(let k of f.ia)if(k.root&&k.root.Oa&e&&(f=l(k.root.o(),h),Math.sqrt(y(f))<=c)){let c=k.ga(O)[0];c&&(c.b=da(f,b));0<d&&k.Ia.na(new qa(d,a,A(m(f,-1))))}}function eb(a,b,c){return a.Bb(c.x,c.y)?!1:!0}function Ma(a,b,c){if(a.Bb(b.x,b.y))return!1;let d=a.Fc(c);if(0==d)return!1;let e=l(c,b);c=a.Gc(c);if(0==e.y&&1<c)return!1;a=a.Hc(b);return 0>e.y&&(0==e.x&&1<d||0!=e.x&&2<a)?!1:!0}function S(a,
{x:b,y:c}){a=a.ea();b=n(a,new C,{x:b,y:c,Aa:8,root:!0});b.h=g(9,6);b.m.idle=new w(t,[4,5],[.12,.12]);b.m.idle.loop=!0;b.play("idle");b.offset.y-=3;q(a,new O);q(a,new fb).ja=2;return a}function E(a,{x:b,y:c}){a=a.ea();b=n(a,new C,{x:b,y:c,Aa:8,root:!0});b.m.walk=new w(t,[2,3]);b.m.walk.loop=!0;b.m.walk.ra(.15);b.offset.y=-5;b.play("walk");c=n(a,new F,{x:-8,y:-2});c.parent=b;c.s=t.va(19);q(a,new O);b=q(a,new ea);b.ja=16;b.Fb=2;return a}function H(a,{x:b,y:c}){a=a.ea();b=n(a,new C,{x:b,y:c,Aa:8,height:12,
root:!0});c=b.m.walk=new w(t,[6,7]);c.loop=!0;c.ra(.25);b.play("walk");b=q(a,new O);b.ka=0;b.ta=!0;b.Ma=!0;b.vb=60;q(a,new ea).ja=3;return a}function T(a,{x:b,y:c}){a=a.ea();b=n(a,new C,{x:b,y:c,Aa:8,height:14,width:13,root:!0});c=b.m.walk=new w(t,[21,22]);c.loop=!0;c.ra(.25);b.play("walk");b.offset.y=-1;b.m.fire=new w(t,[20]);b=q(a,new O);b.ka=0;b.ta=!0;b.Ma=!0;b.vb=50;b=q(a,new gb);b.ja=30;b.fb=30;return a}function hb(a,{x:b,y:c}){let d=a.ea();b=n(d,new C,{x:b,y:c,root:!0});c=b.m["1"]=new w(t,[8,
13]);c.loop=!0;c.ra(.02);b.play("1");b.offset.y=-1;a.g.i(1,()=>d.ba(),d);return d}function ib(a,{x:b,y:c}){let d=a.ea();n(d,new F,{x:b,y:c,width:8,height:7,root:!0}).s=ra.va(42);a=q(d,new fa);a.qb=!0;a.pb=.6;a.Eb=!1;a.Na=2;a=q(d,new sa);a.hb.bind(()=>{I.Fa+=1;d.ba()},a);a.fa=5;a.blink=!0;return d}function ha(a,{x:b,y:c},d){a=a.ea();b=n(a,new Na,{x:b,y:c,root:!0});d&&(b.Ib=d);return a}function Oa(a,{x:b,y:c,Ja:d=15,duration:e=.11}){a=a.ea();b=n(a,new jb,{x:b,y:c,root:!0});{let a=c=0;for(;0===c;)c=
Math.random();for(;0===a;)a=Math.random();c=B(Math.sqrt(-2*Math.log(c))*Math.cos(2*Math.PI*a)/10,-1,1)}b.Ja=(c+1)*d;b.duration=e;return a}function kb(a,{x:b,y:c,item:d=7}){let e=a.ea();var f=n(e,new F,{x:b,y:c,width:14,height:16,root:!0});f.s=ra.va(43);let h=lb(d);h+=5*Math.sign(h)*(J/3|0);let k=n(e,new U,{y:-25});k.parent=f;k.jb(mb(d)+"\ncost: "+h+"\njump to buy");k.visible=!1;f=q(e,new sa);f.hb.bind(()=>k.visible=!0,f);f.ec.bind(()=>k.visible=!1,f);f=q(e,new sa);f.h=[g(b,c-40),g(10,10)];f.hb.bind(()=>
{I.Fa>=h&&(ha(a,{x:b,y:c},.11),I.rc(d),e.l()&&e.ba(),I.Fa-=h)},f);return e}function nb(a,{x:b,y:c}){let d=a.ea(),e=n(d,new C,{x:b,y:c,Aa:8,height:12,root:!0});e.offset.y=-2;b=e.m.idle=new w(t,[14,15]);b.loop=!0;b.ra(.5);e.play("idle");b=e.m.walk=new w(t,[16,17]);b.loop=!0;b.ra(.25);b=q(d,new O);b.Ga*=1.5;b.Wa*=1.5;let f=q(d,new ea);f.xa=!0;f.ja=999;f.fb=200;let h=n(d,new U,{y:-20});h.parent=e;h.jb(Ha("shopping time","only best deals","sale sale!"));a.g.i(2,()=>h.visible=!1,d);d.Ia.bind(()=>{f.xa=
!1;e.play("walk")},d);return d}function ta(a,b,c,d,{fa:e=0,ka:f=1E3,tb:h=4294967295,Da:k=1,Pa:L=0,Lc:r=0}){a=a.ea();let z=n(a,new C,{root:!0});z.f=b;z.h=g(8,6);z.m.fire=new w(t,[27,28],[.02,1]);z.m.explode=new w(t,[29,30,Ha(31,32),62],[.03,.03,.05,1]);z.play("fire");let v=new fa;v.b=c;v.v.y=f;v.fa=e;v.Db.bind(()=>z.play("explode"),z);v.Ab=d;v.Na=h;v.Da=k;v.zb=r;v.Db.bind((a)=>{a.Nb&&a.Nb.Ia.na(new qa(v.Da,v.Ab,a.Cb));x()<L&&Oa(v.a.c,a.f)},a);q(a,v);return a}function ob(a,{x:b,y:c}){let d=a.ea(),e=
new C;(e.m.idle=new w(t,[0,1])).loop=!0;e.m.jump=new w(t,[9]);e.m.dead=new w(t,[12]);e.m.falling=new w(t,[0]);let f=e.m.walk=new w(t,[9,10,11,10]);f.loop=!0;f.ra(.3);e.play("walk");e.offset=g(0,-1);n(d,e,{x:b,y:c,width:10,height:14,Aa:16,root:!0});b=n(d,new F,{x:10,y:0});b.parent=e;b.cb=!0;b.s=t.va(18);n(d,new U,{x:20,y:20});q(d,new Pa);I=q(d,new pb);return a.Tc=d}function qb(a,{x:b,y:c},d){n(a,new F,{x:b,y:c,width:10,height:10}).s=ra.va(33+parseInt(d,16))}function mb(a){switch(a){case 0:return"increased fire rate";
case 1:return"increased bullet range";case 2:return"increased bullet damage";case 3:return"increased bullet num";case 4:return"increased explosion chance";case 5:return"life";case 6:return"finish shopping"}}function lb(a){switch(a){case 0:return 5;case 1:return 5;case 2:return 15;case 3:return 20;case 4:return 5;case 5:return 10;case 6:return-5}}function Qa(){G.wa.Uc();P.u(.016*p.w);K.save();K.clearRect(0,0,V.width,V.height);K.translate(Z.x,Z.y);{var a=K,b=P.ia;let c=[];for(let a of b)for(let b of a.Ba)b instanceof
W&&c.push(b);for(let b of c)b.visible&&b.Vc(a)}K.restore();window.requestAnimationFrame(Qa)}function Ra(){J=0;p.w=1;P=new rb;P.ua=new sb(35,18,14);{var a=P;let b=a.ua,c,d=0,e=a.ea();aa=[];ua=[];va=[];for(let f of"00000000000000000000000000000000000;1                                 0;1                                 0;1 s              i             s  0;10000          11111          00000;1        11             00        0;1                                 0;1   0                         0   0;1   0                         0   0;1   0                         0   0;1   0                         0   0;1   0 si                   is 0   0;1   1010101             1010110   0;1               sis n             0;1             1010101             0;1                                 0;1  s             @             s  0;00000000000000000000111111111111111".split(";")){c=
0;for(let h of f){let f=m(g(c+.5,d+.5),b.sa);if("0"===h||"1"===h)b.Wc(c,d),qb(e,f,h);"@"===h&&ob(a,f);"s"===h&&aa.push(f);"n"===h&&va.push(f);"i"==h&&ua.push(f);c+=1}d+=1}}a=P.ea();wa=q(a,new tb);n(a,new U,{x:V.width/4,y:V.height/4})}function Sa(){if(Ka(ia)){V=document.querySelector("#canvas");K=V.getContext("2d");K.imageSmoothingEnabled=!1;K.scale(2,2);{let a=ja.getContext("2d"),{width:b,height:c}=ja;a.drawImage(ia,0,0);a.fillStyle="white";a.globalCompositeOperation="source-in";a.fillRect(0,0,b,
c)}Ra();G.Mc();window.requestAnimationFrame(Qa)}else setTimeout(Sa,100)}class Y{constructor(a,b){this.x=a;this.y=b}}class D{constructor(a,b){this.x=a;this.y=b}}const ub=new D(1,1),ba=new D(0,0),R=new D(0,-1),oa=new D(0,1),N=new D(-1,0),M=new D(1,0),xa=new D(-1,-1),ya=new D(1,-1),Ta=new D(-1,1),Ua=new D(1,1);class X{constructor(){this.$a=[]}na(...a){for(let b=this.$a.length-1;0<=b;--b){let [c,d]=this.$a[b];d.l()?c.apply(d,a):this.$a.splice(b,1)}}bind(a,b){b.l()&&this.$a.push([a,b])}}class za{constructor(a=
ba,b=R,c=void 0){this.f=a;this.Cb=b;this.Nb=c}}class Q{constructor(){this.name="";this.hc=this.ma=!1}aa(){}l(){return this.a&&this.a.l()}ba(){if(this.a){let a=this.a.Ba.indexOf(this);0<=a&&this.a.Ba.splice(a,1);this.a=void 0}}}class W extends Q{constructor(){super(...arguments);this.f=g(0,0);this.scale=g(1,1);this.qa=0;this.h=g(0,0);this.visible=!0;this.Oa=0}Vc(a){let b=this.f;var c=this.scale;this.parent&&(c=this.xb(),b=pa(ba,c),c=l(pa(ub,c),b));a.save();a.translate(b.x,b.y);a.scale(c.x,c.y);0!=
this.qa&&a.rotate(this.qa);this.Ua(a);a.restore()}o(){return this.parent?pa(ba,this.xb()):ca(this.f)}Qa(a=ba){return[this.o(),u(m(g(this.h.x*Math.abs(this.scale.x),this.h.y*Math.abs(this.scale.y)),.5),a)]}Ic(){return Ia(this.scale.x,0,0,this.scale.y,this.f.x,this.f.y)}xb(){let a=this.parent?this.parent.xb():Ia();var b=this.Ic(),c=a[0],d=a[1],e=a[2],f=a[3],h=a[4],k=a[5],g=a[6],r=a[7],z=a[8],v=b[0],l=b[1],m=b[2],u=b[3],q=b[4],n=b[5],p=b[6],t=b[7];b=b[8];a[0]=v*c+l*f+m*g;a[1]=v*d+l*h+m*r;a[2]=v*e+l*
k+m*z;a[3]=u*c+q*f+n*g;a[4]=u*d+q*h+n*r;a[5]=u*e+q*k+n*z;a[6]=p*c+t*f+b*g;a[7]=p*d+t*h+b*r;a[8]=p*e+t*k+b*z;return a}}class qa{constructor(a,b,c=g()){this.Da=a;this.Ab=b;this.dir=c}}class vb{constructor(){this.Ba=[];this.Ia=new X}l(){return this.c&&this.c===P}ba(){this.c.wc(this)}o(){return this.root.o()}ga(a){return this.Ba.filter((b)=>b instanceof a)}}class rb{constructor(){this.ia=[];this.g=new Aa}u(a){this.g.u(a);for(let b of this.ia)for(let c of b.Ba)c.hc||(c.aa(),c.hc=!0),c.ma&&c.u(a)}ea(){let a=
new vb;a.c=this;this.ia.push(a);return a}wc(a){this.ia.splice(this.ia.indexOf(a),1);a.c=void 0}Rc(a){return this.ia.filter((b)=>b.root&&b.root.Oa&16&&ma(b.root.Qa(),a))}ha(a,b,c,d=4294967295){const e=bb(a,b),f=m(c,.5);let h=[];d&2&&(c=this.ua.ha(a,b,c))&&h.push(new za(c[0],c[1]));if(2===d)return h[0];for(let k of this.ia)if(k.root&&k.root.Oa&d&&(c=k.root.Qa(f),ma(e,c))){let d=na(a,b,c);d?h.push(new za(d[0],d[1],k)):la(a,c)&&(c=l(a,b),h.push(new za(a,y(c)?A(c):R,k)))}return cb(h,(b,c)=>y(l(b.f,a))>
y(l(c.f,a)))}}class wb{constructor(a,b,c,d,e){this.a=a;this.type=b;this.i=c;this.Cc=d;this.Ca=e;this.pa=c}zc(){this.Ca&&this.Ca.l()&&this.Cc.call(this.Ca)}l(){return this.Ca&&this.Ca.l()&&(1===this.type||0===this.type&&0<=this.pa)}Nc(){this.Ca=void 0}reset(){this.pa+=this.i}}class Aa{constructor(){this.bb=[]}u(a){for(let b=this.bb.length-1;0<=b;--b){let c=this.bb[b];c.l()?(c.pa-=a,0>=c.pa&&(c.zc(),1==c.type&&c.reset())):this.bb.splice(b,1)}}Ob(a,b,c,d){a=new wb(this,b,a,c,d);this.bb.push(a);return a}i(a,
b,c){return this.Ob(a,0,b,c)}every(a,b,c){return this.Ob(a,1,b,c)}Xc(a,b,c){let d=!1;return(...e)=>{d||(d=!0,this.i(a,()=>d=!1,c),b.apply(c,e))}}}var Ba={"-":[0,0,0,0,0,0,1,1,1,0,0,0,0,0,0],":":[0,0,0,0,1,0,0,0,0,0,1,0,0,0,0],0:[1,1,1,1,0,1,1,0,1,1,0,1,1,1,1],1:[0,1,0,1,1,0,0,1,0,0,1,0,0,1,0],2:[1,1,1,0,0,1,1,1,1,1,0,0,1,1,1],3:[1,1,1,0,0,1,0,1,1,0,0,1,1,1,1],4:[1,0,1,1,0,1,1,1,1,0,0,1,0,0,1],5:[1,1,1,1,0,0,1,1,1,0,0,1,1,1,0],6:[0,1,1,1,0,0,1,1,1,1,0,1,1,1,1],7:[1,1,1,0,0,1,0,1,0,0,1,0,0,1,0],8:[1,
1,1,1,0,1,1,1,1,1,0,1,1,1,1],9:[1,1,1,1,0,1,1,1,1,0,0,1,1,1,0],A:[0,1,0,1,0,1,1,1,1,1,0,1,1,0,1],B:[1,1,0,1,0,1,1,1,0,1,0,1,1,1,0],C:[1,1,1,1,0,0,1,0,0,1,0,0,1,1,1],D:[1,1,0,1,0,1,1,0,1,1,0,1,1,1,0],E:[1,1,1,1,0,0,1,1,0,1,0,0,1,1,1],F:[1,1,1,1,0,0,1,1,0,1,0,0,1,0,0],G:[1,1,1,1,0,0,1,0,1,1,0,1,1,1,1],H:[1,0,1,1,0,1,1,1,1,1,0,1,1,0,1],I:[0,1,0,0,1,0,0,1,0,0,1,0,0,1,0],J:[1,1,1,0,1,0,0,1,0,0,1,0,1,0,0],K:[1,0,1,1,0,1,1,1,0,1,0,1,1,0,1],L:[1,0,0,1,0,0,1,0,0,1,0,0,1,1,1],N:[0,0,1,1,0,1,1,1,1,1,0,1,1,0,
0],M:[1,0,1,1,1,1,1,0,1,1,0,1,1,0,1],O:[1,1,1,1,0,1,1,0,1,1,0,1,1,1,1],P:[1,1,1,1,0,1,1,1,1,1,0,0,1,0,0],Q:[1,1,1,1,0,1,1,0,1,1,1,0,0,0,1],R:[1,1,0,1,0,1,1,1,0,1,0,1,1,0,1],S:[1,1,1,1,0,0,1,1,0,0,0,1,1,1,1],T:[1,1,1,0,1,0,0,1,0,0,1,0,0,1,0],U:[1,0,1,1,0,1,1,0,1,1,0,1,1,1,1],W:[1,0,1,1,0,1,1,0,1,1,1,1,1,0,1],V:[1,0,1,1,0,1,1,0,1,1,0,1,0,1,0],X:[1,0,1,1,0,1,0,1,0,1,0,1,1,0,1],Y:[1,0,1,1,0,1,1,0,1,0,1,0,0,1,0],Z:[1,1,1,0,0,1,0,1,0,1,0,0,1,1,1]};class xb{constructor(){this.Qb={};let a=this.Ya=5,b=this.Xa=
7,c=Object.keys(Ba).length;this.uc=Ja(a*c+1,b,(b)=>{let c=0;for(let e in Ba){for(let a of[0,2,1])for(let c of[0,2,1]){b.fillStyle=1==a&&1==c?"#fff":"#000";b.save();b.translate(a,c);var d=b,h=e;for(let a=0;3>a;++a)for(let b=0;5>b;++b)Ba[h][3*b+a]&&d.fillRect(a,b,1,1);b.restore()}this.Qb[e]=c;c+=a;b.translate(a,0)}})}}const yb=new xb;class Va{constructor(a,b,c,d){this.image=a;this.Ta=b;this.position=c;this.size=d}l(){return Ka(this.image)}}class Wa{constructor(a,b,c,d){this.image=a;this.Oc=b;this.Pb=
c;this.Xb=d}va(a){return new Va(this.image,this.Oc,Da(g(a%this.Xb.x,Math.floor(a/this.Xb.x)),this.Pb),this.Pb)}}class w{constructor(a,b,c){this.lc=a;this.frames=b;this.Ea=c;this.loop=!1;this.lb=this.ca=0;this.Ea?this.lb=this.Ea.reduce((a,b)=>a+b):this.ra(1)}ra(a){this.Ea=this.frames.map(()=>a/this.frames.length);this.lb=this.Ea.reduce((a,c)=>a+c)}u(a){this.ca+=a;this.loop&&this.ca>this.lb&&(this.ca-=this.lb)}Wb(){for(let a=0,b=0;a<this.Ea.length;++a)if(b+=this.Ea[a],this.ca<b)return this.lc.va(this.frames[a]);
return this.lc.va(this.frames[this.frames.length-1])}}let G;(function(a){class b{constructor(a=!1,b=0){this.da=a;this.timestamp=b}}let c;(function(a){function c(a){let c=g[a];c||(g[a]=c=new b);return c}function d(a){a instanceof KeyboardEvent&&(m=!1);let b=c(a.key);b.da||(b.da=!0,b.timestamp=Date.now(),l[a.key]&&l[a.key].na(),a.preventDefault())}function h(a){c(a.key).da=!1}const g={},l={};a.ob=function(a,b,c){let d=l[a];d||(d=l[a]=new X);d.bind(b,c)};a.da=function(a){return g[a]?g[a].da:!1};a.bd=
c;a.$b=function(a){return(a=g[a])&&a.da?20>Date.now()-a.timestamp:!1};a.Pc=d;a.Qc=h;class r{constructor(a){this.key=a}preventDefault(){}}let m=!1;a.Uc=function(){let a=navigator.getGamepads()[0];!m&&a&&(m=a.buttons[0].pressed);m&&a&&(a.buttons[0].pressed?d(new r(" ")):c(" ").da&&h(new r(" ")),a.buttons[2].pressed?d(new r("z")):a.buttons[7].pressed?d(new r("z")):a.buttons[6].pressed?d(new r("z")):c("z").da&&h(new r("z")),a.buttons[1].pressed?d(new r("x")):c("x").da&&h(new r("x")),.5<a.axes[0]?d(new r("ArrowRight")):
c("ArrowRight").da&&h(new r("ArrowRight")),-.5>a.axes[0]?d(new r("ArrowLeft")):c("ArrowLeft").da&&h(new r("ArrowLeft")))}})(c=a.wa||(a.wa={}));a.Mc=function(){window.addEventListener("keydown",c.Pc);window.addEventListener("keyup",c.Qc)}})(G||(G={}));const zb=[xa,R,ya,N,M],Xa=[N,M,R,xa,ya,Ta,Ua,oa],Ab=[Ta,Ua,oa,xa,ya,N,M,R];class sb{constructor(a,b,c=10){this.width=a;this.height=b;this.sa=c;this.ya=[];this.eb=[];this.Ra=[];for(c=0;c<b;++c)this.ya[c]=Array(a).fill(99),this.eb[c]=Array(a).fill(99),
this.Ra[c]=Array(a).fill(99)}Wc(a,b){a=g(a,b);this.l(a)&&(this.Zc(a),this.$c(a),this.ad(a))}Fc(a){return this.l(a)?this.ya[a.y][a.x]:Number.MAX_VALUE}Gc(a){return this.l(a)?this.eb[a.y][a.x]:Number.MAX_VALUE}Hc(a){return this.l(a)?this.Ra[a.y][a.x]:Number.MAX_VALUE}l(a){return 0<=a.x&&a.x<this.width&&0<=a.y&&a.y<this.height}Zc(a){for(a=[[a,0]];a.length;){var [b,c]=a.shift();this.ya[b.y][b.x]=c;for(let d of zb){let e=u(b,d);this.l(e)&&this.ya[e.y][e.x]>c+1&&(this.ya[e.y][e.x]=c+1,a.push([e,c+1]))}}}$c(a){for(let b=
ca(a),c=0;0<=b.y&&!(this.eb[b.y][b.x]<c);--b.y,++c)this.eb[b.y][b.x]=c}ad(a){this.Ra[a.y][a.x]=0;for(let c=a.y-1;c>=a.y-5;--c)for(let d=a.x-5;d<a.x+5;++d){let e=g(d,c);if(this.l(e)){var b=l(e,a);b=Math.abs(b.x)+Math.abs(b.y);this.Ra[e.y][e.x]>b&&(this.Ra[e.y][e.x]=b)}}}Bb(a,b){return 0<=a&&a<this.width&&0<=b&&b<this.height?0===this.ya[b][a]:!1}Dc(a,b,c){var d=this.ib(a);let e=this.ib(b),f=l(e,d);b=l(b,a);if(0==f.x||0==f.y)for(let a=d.y,b=d.x;!c(b,a)&&(a!=e.y||b!=e.x);)0==f.y&&(b+=Math.sign(f.x)),
0==f.x&&(a+=Math.sign(f.y));else{b=b.y/b.x;a=a.y-b*a.x;var g=this.sa;for(d=d.y;;){var k=0<b;let h=Math.floor(((d+(k?0:1))*g-a)/b/g);k=Math.floor(((d+(k?1:0))*g-a)/b/g);if(0>f.x){let a=h;h=k;k=a}for(;;){if(c(h,d))return;if(h==k)break;h+=0<f.x?1:-1}if(d!=e.y)d+=Math.sign(f.y);else break}}}ha(a,b,c){let d=g(Math.max(0,Math.ceil(c.x/this.sa)+1),Math.max(0,Math.ceil(c.y/this.sa)+1)),e=g(Math.floor(d.x/2),Math.floor(d.y/2));const f=this.sa,h=m(g(f,f),.5),k=m(c,.5);let q=l(b,a);y(q)&&(q=A(q));let r;this.Dc(a,
b,(c,d)=>{var n=[];for(let r=d-e.y;r<=d+e.y;++r)for(let d=c-e.x;d<=c+e.x;++d){var p=m(g(d+.5,r+.5),f),t=l(p,a);0<y(t)&&-.5>Ea(q,A(t))||!this.Bb(d,r)||(p=[p,u(k,h)],la(a,p)?(t=l(a,b),p=na(u(a,m(t,999)),a,p),n.push(p)):(p=na(a,b,p))&&n.push(p))}c=Number.MAX_VALUE;for(let b of n){var [n]=b;n=y(l(n,a));n<c&&(c=n,r=b)}return r?!0:!1});return r}Tb(a,b,c,d=Xa){a=this.ib(a);var e=this.ib(b);let f=(a)=>a.y*this.width+a.x,h=[a];a=[f(a)];for(b=[-1];h.length;){let g=h.shift();if(g.x==e.x&&g.y==e.y)break;for(let e of d){let d=
u(g,e);if(!this.l(d))continue;let k=f(d);0<=a.indexOf(k)||!c(this,g,d)||(h.push(d),a.push(k),b.push(f(g)))}}c=(a)=>m(g(a%this.width+.5,Math.floor(a/this.width)+.5),this.sa);d=[c(f(e))];for(e=a.indexOf(f(e));-1!=e;){e=b[e];if(-1==e)break;d.unshift(c(e));e=a.indexOf(e)}return 1<d.length?d:void 0}ib(a){return g(Math.floor(a.x/this.sa),Math.floor(a.y/this.sa))}}class Ya extends Q{constructor(){super(...arguments);this.cc=300;this.Ga=100;this.ka=1E3;this.Ma=!1;this.Rb=!0;this.b=g();this.v=g();this.Ha=
this.la=!1;this.ma=!0}Lb(a){let b=this.a.root,c=this.a.c.ua,d=c.ha(b.f,u(b.f,m(N,a)),b.h);return d?d:c.ha(b.f,u(b.f,m(M,a)),b.h)}Yc(){let a=this.a.root;return this.a.c.ua.ha(a.f,u(a.f,g(0,5)),a.h)}u(a){this.Rb&&this.gc();let b=this.a.root;var c=this.a.c.ua;this.b.y+=this.ka*a;this.b=u(this.b,m(this.v,a));this.b=da(this.b,0,this.cc);a=u(b.f,m(this.b,a));var d=c.ha(b.f,a,b.h);if(d){let [e,f]=d;this.bc=d;0!=f.y&&(a.y=e.y,a.x!=e.x&&(d=c.ha(e,a,b.h))&&(a.x=d[0].x),this.b.y*=this.Ma?-x(.2,.5):0);0!=f.x&&
(a.x=e.x,a.y!=e.y&&(c=c.ha(e,a,b.h))&&(a.y=c[0].y),this.b.x*=this.Ma?-x(.2,.5):0)}b.f.x=a.x;b.f.y=a.y;this.la=!!this.Yc()}}class Bb extends W{constructor(){super(...arguments);this.Ja=5;this.angle=0}Ua(a){a.beginPath();a.moveTo(0,0);a.arc(0,0,this.Ja,0,this.angle);a.closePath();a.lineWidth=2;a.strokeStyle="#000";a.stroke();a.fillStyle="#fff";a.fill()}}class F extends W{constructor(){super(...arguments);this.s=new Va(null,null,ba,g(10,10));this.cb=!1;this.offset=g();this.Ta=!1}blink(){this.Ta=!0;this.a.c.g.i(.05,
()=>this.visible=!0,this);this.a.c.g.i(.1,()=>this.Ta=!1,this)}Ua(a){const b=this.s.position,c=this.s.size;this.cb&&a.scale(-1,1);this.s.l()?a.drawImage(this.Ta?this.s.Ta:this.s.image,b.x,b.y,c.x,c.y,-c.x/2+this.offset.x,-c.y/2+this.offset.y,c.x,c.y):(a.fillStyle="red",a.fillRect(-c.x/2,-c.y/2,c.x,c.y))}}class C extends F{constructor(){super(...arguments);this.m={};this.Za="";this.ma=!0}play(a){this.Za!=a&&(this.Za=a,this.s=this.m[a].Wb())}u(a){if(this.Za){let b=this.m[this.Za];b.u(a);this.s=b.Wb()}}}
class U extends W{constructor(){super(...arguments);this.text="";this.font=yb}jb(a){let b=a.split("\n");this.h.x=b.map((a)=>a.length).sort().pop()*(this.font.Ya-1)+1;this.h.y=b.length*(this.font.Xa+1);this.text=a}Ua(a){db(this.font,a,this.text,m(this.h,-.5))}}class jb extends W{constructor(){super(...arguments);this.ma=!0;this.duration=.11;this.ab=0;this.Ja=10}aa(){La(this.a,200,this.Ja,1)}u(a){a*=1/p.w;this.ab>this.duration&&(this.a.ba(),Z=g());Z.x=x(-1,1);Z.y=x(-1,1);this.ab+=a}Ua(a){let b=this.ab/
this.duration,c=a.globalCompositeOperation;.5<b&&(a.globalCompositeOperation="difference");a.beginPath();a.arc(0,0,this.Ja,0,2*Math.PI);a.fillStyle=.5>b?"#000":"#fff";a.fill();a.globalCompositeOperation=c}}class Na extends W{constructor(){super(...arguments);this.ma=!0;this.mc=10;this.yc=400;this.Sb=.25;this.Ib=.13;this.ca=0;this.Vb=!1}aa(){La(this.a,600,99999,0)}u(a){this.ca+=a;this.ca<this.Ib&&(p.w=B(1-this.ca/.1,.01,1));this.ca>this.Ib&&!this.Vb&&(this.Vb=!0,p.w=1);this.ca>this.Sb&&this.a.ba()}Ua(a){var b=
B(this.ca/this.Sb,0,1);a.beginPath();a.arc(0,0,this.mc+(this.yc-this.mc)*b,0,2*Math.PI);b=a.globalCompositeOperation;a.globalCompositeOperation="difference";a.strokeStyle="#fff";a.lineWidth=3;a.stroke();a.globalCompositeOperation=b}}class sa extends Q{constructor(){super(...arguments);this.hb=new X;this.ec=new X;this.fa=0;this.blink=!1;this.ma=!0;this.gb=!1;this.g=new Aa}aa(){0<this.fa&&(this.a.c.g.i(this.fa,this.a.ba,this.a),this.blink&&this.a.c.g.i(Math.max(this.fa-1,0),()=>{this.g.every(.1,this.vc,
this)},this))}u(a){let b=this.a.root,c=this.a.c;this.g.u(1*a/p.w);a=c.Rc(this.h?this.h:b.Qa());a[0]&&!this.gb?(this.hb.na(),this.gb=!0):!a[0]&&this.gb&&(this.ec.na(),this.gb=!1)}vc(){let a=this.a.root;a.visible=!a.visible}}class Pa extends Ya{gc(){this.v.x=0;this.v.y=0;var a=G.wa;const b=a.da("ArrowLeft"),c=a.da("ArrowRight");a=a.$b("ArrowUp")||a.$b(" ");b||c?(this.v.x=b?-900:900,this.Ha=b,this.b.x=B(this.b.x,-this.Ga,this.Ga)):this.la&&(this.b.x*=.4);if(a)if(this.la)this.v.y=-9E4;else if(b||c)if(a=
this.Lb(7)){var [d,e]=a;a=this.a.root;a=5>Math.sqrt(y(l(d,a.f)))-a.h.x/2;let f=!1;b&&(f=0>e.x);c&&(f=0<e.x);a&&(this.v.x=900*e.x*(f?10:50),this.v.y=-900*(f?60:200))}}u(a){1>p.w?(a=1*a/p.w*.8,this.ka=800):this.ka=1E3;super.u(a)}}class fa extends Q{constructor(){super(...arguments);this.v=g(0,1E3);this.b=g();this.fa=0;this.Da=1;this.Eb=!0;this.qb=!1;this.pb=.5;this.zb=0;this.Ab=null;this.Na=4294967295;this.Db=new X;this.ma=!0}aa(){0<this.fa&&this.a.c.g.i(this.fa,()=>this.a.ba(),this.a)}u(a){let b=this.a.root;
var c=this.a.c;0<this.zb&&this.qc();this.b=u(this.b,m(this.v,a));a=m(this.b,a);a=u(b.f,a);(c=c.ha(b.f,a,b.h,this.Na))?(this.qb?(0!=c.Cb.x&&(this.b.x*=-this.pb),0!=c.Cb.y&&(this.b.y*=-this.pb)):(this.b=g(),this.v=g(),this.ma=!1),b.f=ca(c.f),this.Db.na(c,this)):(b.f=a,this.Eb&&(b.qa=Math.atan2(this.b.y,this.b.x)))}qc(){let a,b=.9,c=this.a.o(),d=A(this.b);for(let f of this.a.c.ia)if(f.root&&f.root.Oa&this.Na){let g=f.o();var e=l(g,c);e=Ea(d,A(e));e>b&&(a=g,b=e)}a&&(this.v.y=l(a,c).y*this.zb*10*(1-b))}}
class pb extends Q{constructor(){super(...arguments);this.sb=300;this.za=1;this.Pa=.1;this.rb=1;this.Kc=0;this.Ec=3;this.jc=8;this.Sa=3;this.Fa=0;this.ma=this.Gb=!0;this.wb=3;this.Hb=!1;this.g=new Aa}aa(){[this.$]=this.a.ga(Pa);[this.s]=this.a.ga(C);[this.Jb]=this.a.ga(U);this.La=this.a.ga(F)[1];this.a.Ia.bind(this.Va,this);this.ic(this.wb);G.wa.ob("x",this.pc,this);G.wa.ob("p",()=>alert("pause"),this)}u(a){this.g.u(1*a/p.w);this.s.cb=!this.$.Ha;this.La.f.x=this.$.Ha?-10:10;this.La.cb=!this.$.Ha;
this.La.qa*=.9;a=this.$.b;this.$.la?ab(a.x,0,3)?this.s.play("idle"):this.s.play("walk"):this.s.play("jump");G.wa.da("z")&&this.Bc();this.Jb.jb(`lives: ${this.Sa}\ngems:  ${this.Fa}\nwave:  ${J}`);this.Jb.f=u(g(20,20),m(this.Jb.h,.5))}pc(){if(!this.Hb){this.Hb=!0;var a=n(this.a,new Bb,{y:-18});a.parent=this.a.root;var b=0;this.a.c.g.every(.05,()=>{b+=.05;b<this.jc?a.angle=2*Math.PI*(1-b/this.jc):(a.ba(),this.Hb=!1)},a);ha(this.a.c,u(this.a.o(),g(0,3)))}}Va(a){!this.Gb||1>p.w||(this.Gb=!1,this.$.b.x+=
100*a.dir.x,this.$.b.y-=100,--this.Sa,ha(this.a.c,u(this.a.o(),g(0,3))),0<this.Sa?(this.s.blink(),Oa(this.a.c,{x:-100,y:-100,duration:.1}),this.a.c.g.i(.5,()=>this.Gb=!0,this)):this.yb())}yb(){let a=this.a.c;this.a.c.g.i(.05,()=>{a.ia.forEach((a)=>a.ga(Na)[0]&&a.ba());p.w=.01},this.a);this.s.play("dead");wa.print(`    you died\nwaves survived: ${J}\n\npress z to restart`);G.wa.ob("z",()=>setTimeout(Ra,0),this.a);{let a=q(this.a,new fa);a.b=this.$.b;a.Na=2;a.Eb=!1;a.qb=!0;this.$.ba();this.ba()}}ic(a){this.wb=
a;this.Bc=this.g.Xc(1/B(a,.5,1E3),this.Ac,this)}Ac(){let a=this.a,b=this.$.Ha?N:M;var c=B(.087*(this.za-1),0,.785)*b.x;let d=0;1<this.za&&(d=2*c/(this.za-1));b=Ga(b,-c);for(c=0;c<this.za;++c)ta(a.c,this.La.o(),m(b,1*this.sb/p.w),this.a,{fa:.3,ka:0,tb:10,Da:this.rb,Pa:this.Pa,Lc:.02>p.w?5E4:this.Kc}),b=Ga(b,d);this.$.la&&(this.$.b.x+=-.1*b.x);this.La.qa=this.$.Ha?1.57:-1.57}rc(a){switch(a){case 2:this.rb+=1;break;case 4:this.Pa=B(this.Pa+.1,0,1);break;case 3:this.za+=1;break;case 1:this.sb+=50;break;
case 0:this.ic(this.wb+2);break;case 5:this.Sa+=1;break;case 6:wa.Ub()}}}class tb extends Q{constructor(){super(...arguments);this.mb=[[[S,2]],[[S,6]],[[H,1]],[],[[S,4],[H,2]],[[S,6],[H,2]],[[H,6]],[],[[T,1]],[],[[E,1]],[[E,2],[S,2]],[[E,2],[H,2]],[],[[E,2],[H,4]],[[E,4],[H,4]],[[E,6],[H,2]],[],[[T,2]],[],[[E,2],[T,1]],[[E,4],[T,2]],[],[[T,2],[S,10]],[[T,4]],[],[[E,10]]];this.Ka=[]}aa(){[this.ub]=this.a.ga(U);Za.bind(this.dc,this);this.a.c.g.i(2,this.kc,this);this.print(" bulletcraft\n\ngame by kakus\n js13k 2018",
5);this.a.c.g.i(5,()=>this.print("controls\narrows + z x\nxbox gamepad",10),this)}print(a,b=0){this.ub.visible=!0;this.ub.jb(a);this.fc&&this.fc.Nc();b&&(this.fc=this.a.c.g.i(b,()=>this.ub.visible=!1,this))}dc(a){this.Ka.every((b)=>!b.l()||b===a)&&(J+=1,this.a.c.g.i(3,this.kc,this))}Ub(){this.Yb()&&(this.Ka.forEach((a)=>a.l()&&a.ba()),this.dc(void 0))}kc(){let a=this.a.c,b=this.mb[J%this.mb.length],c=aa.length,d=0;this.Ka=[];if(this.Yb()){var e=[];for(var f=0;7>f;++f)e[f]=f;f=6;for(let b of ua)this.Ka.push(kb(a,
{x:b.x,y:b.y,item:e[f]})),e.splice(f,1),f=x(0,e.length-.01)|0;e=nb(a,va[0]);this.Ka.push(e);let b=20;this.a.c.g.i(b,this.Ub,this);this.a.c.g.every(1,()=>{this.print(`shopping ends in ${--b}`,1.1)},e)}for(let [,f]of b)for(e=0;e<f;++e)hb(a,aa[d%c]),d+=1;this.a.c.g.i(1,()=>{d=0;for(let [e,f]of b)for(let b=0;b<f;++b)this.Ka.push(e(a,aa[d%c])),d+=1},this)}Yb(){return 0===this.mb[J%this.mb.length].length}}const Za=new X;class O extends Ya{constructor(){super(...arguments);this.Wa=this.Jc=500;this.Zb=300;
this.ta=!1;this.vb=300;this.input=g()}u(a){this.Rb=1==p.w;this.cc=1!=p.w?9999:this.vb;super.u(a)}gc(){if(this.ta){this.v=m(this.input,this.Wa);var a=this.Lb(3);a&&(this.b.x=80*a[1].x)}else if(0!=this.input.x?(this.v.x=this.input.x*(this.la?this.Jc:this.Wa),this.b.x=B(this.b.x,-this.Ga,this.Ga)):this.la&&(this.b.x*=.8),0>this.input.y)if(a=this.Lb(3),this.la&&!a)this.b.y=-this.Zb;else{if(a){var [,a]=a;this.b=g(80*a.x,-this.Zb)}}else this.v.y=0}}class $a extends Q{constructor(){super(...arguments);this.fb=
this.tc=this.ja=1;this.sc=.5;this.xa=!1}aa(){super.aa();[this.j]=this.a.ga(O);[this.kb]=this.a.ga(C);this.target=this.a.c.Tc;this.root=this.a.root;this.a.Ia.bind(this.Va,this);this.a.c.g.every(.1,this.update,this);this.ja*=Math.ceil(J/26)}update(){this.j&&0!=this.j.input.x&&this.kb&&(this.kb.scale.x=0<this.j.input.x?-1:1);if(this.Sc()&&!this.xa){let a=l(this.target.o(),this.a.o());this.target.Ia.na(new qa(this.tc,this.a,a));this.a.c.g.i(this.sc,()=>this.xa=!1,this);this.xa=!0}}Va(a){this.bc=a;this.ja-=
a.Da;this.root instanceof F&&this.root.blink();0>=this.ja&&this.yb()}yb(){let a=this.a.c;for(let b=x(this.fb,this.fb+I.Ec);0<=b;--b){let b=ib(a,this.a.o()).ga(fa)[0],d=this.bc.dir;b.b.x=(0!=d.x?d.x:1)*-x(100,200);b.b.y=x(200,400)}1>p.w&&ha(a,this.a.o());Za.na(this.a);this.a.ba()}Sc(){return ma(this.root.Qa(),this.target.root.Qa())}}class fb extends $a{aa(){super.aa();this.j.Ma=!0;this.a.c.g.i(x(),()=>{this.a.c.g.every(x(2.6,3),this.xc.bind(this),this.a)},this.a)}xc(){var a=ka(l(this.target.o(),this.root.f));
let b=this.a.c,c=this.root.f;var d=this.a.c.ua.Tb(this.root.f,this.target.root.f,Ma);if(d)for(let b=1;b<d.length&&(a=ka(l(d[b],d[b-1])),0==a.x);++b);d=m(g(300*a.x,-300),x(.5,1));a=b.ha(c,u(c,g(20*a.x,-20)),this.root.h,2);this.j.b=a?Da(d,g(.2,1.5)):d}}class ea extends $a{constructor(){super(...arguments);this.oa=1;this.Fb=0}aa(){super.aa();this.oc=this.a.c.g.every(.033,this.Kb,this);0<this.Fb&&(this.nb=this.a.ga(F)[1],this.a.c.g.every(this.Fb,this.Mb,this))}Kb(){if(!this.xa){this.nb&&(this.nb.qa=Math.PI/
3);this.oa=B(this.oa+.01,0,1);var a=this.a.c.ua.Tb(this.root.f,this.target.root.f,this.j.ta?eb:Ma,this.j.ta?Ab:Xa);a?this.j.input=m(ka(l(a[1],a[0])),x(.5,1)):(this.j.input.x=0,this.j.input.y=0)}}Va(a){this.oc.pa=.5*this.oa;this.ac(a.dir);this.oa=B(this.oa-.1,0,1);super.Va(a)}ac(a){this.j.input=g();this.j.b.x-=160*a.x*this.oa*(this.j.ta?.5:1);this.j.b.y-=160*this.oa*(this.j.ta?0:1)}nc(a=1){this.oc.pa=a;this.j.input=g();this.j.b=g();this.j.v=g()}Mb(){if(this.j.la){var a=this.a.c,b=this.a.o(),c=ca(0<
this.j.b.x?M:N);if(this.a.c.ha(b,u(b,g(1E3*c.x,0)),g(2,2),16)){this.nc();this.nb.qa=0;let b=u(this.nb.o(),m(A(c),3)),e=da(g(c.x,0),200);this.a.c.g.i(.5,()=>{ta(a,b,e,this.a,{fa:3,ka:0,tb:18});this.ac(A(e))},this)}}}}class gb extends ea{aa(){super.aa();this.a.c.g.every(5,()=>{this.kb.play("fire");this.nc(1.8);for(let a=0;3>a;++a)this.a.c.g.i(.8+.1*a,this.Mb,this)},this)}Kb(a){super.Kb(a);this.kb.play("walk");this.oa=0}Mb(){let a=this.a.c,b=this.a.o();var c=this.target.o();c=da(l(c,b),200);ta(a,b,c,
this.a,{fa:3,ka:0,tb:16})}}const ia=(()=>{let a=new Image;a.src="s.png";return a})(),ja=Ja(128,128),t=new Wa(ia,ja,g(14,18),g(9,9)),ra=new Wa(ia,ja,g(14,14),g(9,10));let J=0,aa=[],ua=[],va=[],Z=g(),P,wa,I,K,V;p.w=1;Sa()})(Ca||(Ca={}));</script>